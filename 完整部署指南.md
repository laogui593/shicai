# 彩票系统完整部署指南

## 重要说明

这是一个**完整的在线彩票管理系统**，包含：
- ✅ 前台用户界面（投注、充值、提现等）
- ✅ 后台管理系统（管理员、会员、订单、预设等）
- ✅ WebSocket实时通信
- ✅ 完整数据库（99MB SQL文件）

## 系统功能模块

### 前台功能（Application/Home/）
1. **首页** - IndexController
2. **游戏大厅** - RunController（PK10、时时彩、28彩票、六合彩、快3等）
3. **用户中心** - UserController
   - 充值提现
   - 投注记录
   - 资金明细
   - 个人信息
   - 银行卡管理
4. **代理系统** - FenController
5. **API接口** - ApiController
6. **WebSocket实时开奖** - WorkermanController系列

### 后台功能（Application/Admin/）
1. **管理员管理** - AdminController
2. **会员管理** - MemberController
3. **订单管理** - OrderController
4. **预设管理** - YusheController
5. **站点配置** - SiteController
6. **机器人管理** - RobotController
7. **数据采集** - CaijiController
8. **分销管理** - FenController

## 部署步骤

### 1. 安装MySQL数据库

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install mysql-server

# 启动MySQL
sudo service mysql start

# 登录MySQL
sudo mysql -u root -p
```

### 2. 创建数据库

```sql
CREATE DATABASE shicai CHARACTER SET utf8 COLLATE utf8_general_ci;
CREATE USER 'shicai'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON shicai.* TO 'shicai'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### 3. 导入数据库

```bash
cd /workspaces/shicai
mysql -u shicai -p shicai < think_admin.sql
```

这个SQL文件包含所有必需的表：
- think_admin（管理员表）
- think_user（用户表）
- think_order（订单表）
- think_lottery（彩票配置表）
- think_robot（机器人表）
- think_config_one（系统配置表）
- 还有50+其他数据表...

### 4. 配置数据库连接

编辑 `Application/Common/Conf/db.php`:

```php
<?php
return array(
	'DB_TYPE' => 'mysql',
    'DB_HOST' => 'localhost',
    'DB_NAME' => 'shicai',
    'DB_USER' => 'shicai',
    'DB_PWD' => 'your_password',  // 修改为你的密码
    'DB_PORT' => '3306',
    'DB_PREFIX' => 'think_',
	'DB_CHARSET'=> 'utf8',
	'DB_DEBUG'  => true,
);
?>
```

### 5. 安装PHP扩展

```bash
# 安装必需的PHP扩展
sudo apt-get install php-mysql php-pdo php-mbstring php-curl php-json php-xml

# 重启PHP服务
sudo service php8.0-fpm restart
```

### 6. 配置网站权限

```bash
cd /workspaces/shicai
chmod -R 777 Runtime/
chmod -R 777 Uploads/
chmod -R 777 up_files/
```

### 7. 启动服务

#### 方法1: PHP内置服务器（开发环境）
```bash
cd /workspaces/shicai
php -S 0.0.0.0:8001 index.php
```

#### 方法2: Nginx + PHP-FPM（生产环境）

创建Nginx配置 `/etc/nginx/sites-available/shicai`:

```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /workspaces/shicai;
    index index.php index.html;

    location / {
        if (!-e $request_filename) {
            rewrite ^(.*)$ /index.php?s=$1 last;
            break;
        }
    }

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.0-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

启动Nginx:
```bash
sudo ln -s /etc/nginx/sites-available/shicai /etc/nginx/sites-enabled/
sudo nginx -t
sudo service nginx restart
```

### 8. 启动WebSocket服务

```bash
cd /workspaces/shicai
php workerman_server.php start -d
```

查看WebSocket状态:
```bash
php workerman_server.php status
```

## 访问系统

### 前台访问
```
http://your-domain.com/
或
http://localhost:8001/
```

### 后台访问
```
http://your-domain.com/admin
或
http://localhost:8001/admin
```

默认管理员账号（请在导入数据库后从SQL文件中查找）：
- 用户名: admin
- 密码: 查看SQL文件中的加密密码

## 目录结构说明

```
shicai/
├── Application/              # 应用程序
│   ├── Home/                # 前台模块
│   │   ├── Controller/      # 控制器
│   │   ├── Model/           # 模型
│   │   └── View/            # 视图
│   ├── Admin/               # 后台模块
│   │   ├── Controller/      # 后台控制器
│   │   ├── Model/           # 后台模型
│   │   └── View/            # 后台视图
│   ├── Agent/               # 代理模块
│   └── Common/              # 公共模块
│       ├── Api/             # API类
│       ├── Common/          # 公共函数
│       └── Conf/            # 配置文件
├── Public/                  # 静态资源
│   ├── Admin/              # 后台静态资源
│   ├── Home/               # 前台静态资源
│   └── Common/             # 公共静态资源
├── Template/                # 模板文件
│   ├── Admin/              # 后台模板
│   ├── Home/               # 前台模板
│   └── Agent/              # 代理模板
├── ThinkPHP/               # ThinkPHP框架
├── Runtime/                # 运行时缓存
├── Uploads/                # 上传文件
├── Workerman/              # WebSocket库
├── index.php               # 入口文件
├── workerman_server.php    # WebSocket服务器
└── think_admin.sql         # 完整数据库（99MB）
```

## 游戏类型

系统支持以下彩票游戏：
1. **北京PK10** - pk10.html
2. **时时彩** - ssc.html
3. **加拿大28** - jnd28.html
4. **北京28** - bj28.html
5. **幸运飞艇** - xyft.html
6. **六合彩** - lhc.html
7. **快3** - k3.html
8. **二七五时时彩** - er75sc.html
9. **百家乐** - baijiale.html

每个游戏都有：
- 单式投注
- 复式投注
- 开奖记录
- 走势图
- 玩法说明

## WebSocket功能

系统使用Workerman实现实时功能：
- 实时开奖推送
- 在线人数统计
- 实时投注数据
- 聊天室功能

## 常见问题

### 1. 无法连接数据库
- 检查MySQL是否运行：`sudo service mysql status`
- 检查数据库用户名密码是否正确
- 检查PHP是否安装pdo_mysql扩展：`php -m | grep pdo_mysql`

### 2. 页面空白
- 检查PHP错误日志：`tail -f /var/log/php8.0-fpm.log`
- 检查Runtime目录权限：`chmod -R 777 Runtime/`
- 开启调试模式：修改index.php中的`define('APP_DEBUG',true);`

### 3. WebSocket无法启动
- 检查端口是否被占用：`netstat -tlnp | grep 2120`
- 检查防火墙设置
- 查看workerman日志：`tail -f websocket.log`

### 4. 静态资源404
- 检查Nginx配置中的root路径
- 检查文件权限
- 清除浏览器缓存

## 安全建议

1. **修改默认密码**
   - 立即修改管理员密码
   - 修改数据库密码

2. **文件权限**
   ```bash
   # 设置合适的权限
   chmod 755 /workspaces/shicai
   chmod 644 index.php
   chmod -R 777 Runtime/
   chmod -R 755 Uploads/
   ```

3. **关闭调试模式**
   - 生产环境设置：`define('APP_DEBUG',false);`

4. **配置防火墙**
   ```bash
   # 只开放必要端口
   sudo ufw allow 80/tcp
   sudo ufw allow 443/tcp
   sudo ufw enable
   ```

## 技术支持

- ThinkPHP版本: 3.2.3
- PHP要求: >= 5.3.0（推荐8.0+）
- MySQL要求: >= 5.5
- 数据库大小: 99MB（完整数据）
- 表数量: 50+张表

## 维护命令

```bash
# 查看日志
tail -f Runtime/Logs/Home/*.log
tail -f Runtime/Logs/Admin/*.log

# 清除缓存
rm -rf Runtime/Cache/*
rm -rf Runtime/Temp/*

# 重启WebSocket
php workerman_server.php restart

# 备份数据库
mysqldump -u shicai -p shicai > backup_$(date +%Y%m%d).sql
```

---

**注意**: 这是一个完整的商业级彩票系统，包含99MB的完整数据库。所有前后台功能都已就绪，只需正确配置MySQL数据库并导入SQL文件即可使用。
